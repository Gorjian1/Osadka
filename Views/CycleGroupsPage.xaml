<UserControl x:Class="Osadka.Views.CycleGroupsPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:Osadka.ViewModels"
             mc:Ignorable="d"
             d:DesignWidth="1280"
             d:DesignHeight="720">
    <UserControl.Resources>
        <Style x:Key="RowHeaderText" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#212121"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
        </Style>
        <DataTemplate x:Key="CycleHeaderTemplate" DataType="vm:CycleColumnHeader">
            <Border BorderBrush="#D0D7E5"
                    BorderThickness="0,0,1,1"
                    Background="#F5F8FF"
                    Padding="8"
                    MinWidth="88"
                    MinHeight="36">
                <StackPanel>
                    <TextBlock Text="{Binding Label}" FontWeight="SemiBold" TextWrapping="Wrap"/>
                    <TextBlock Text="{Binding Number, StringFormat='№ {0}'}"
                               FontSize="12"
                               Foreground="#657196"/>
                </StackPanel>
            </Border>
        </DataTemplate>
        <ItemsPanelTemplate x:Key="CycleHeaderPanel">
            <UniformGrid Rows="1"/>
        </ItemsPanelTemplate>
        <ItemsPanelTemplate x:Key="CycleRowPanel">
            <UniformGrid Rows="1"/>
        </ItemsPanelTemplate>
        <DataTemplate x:Key="CycleCellTemplate" DataType="vm:CycleDisplayCell">
            <Border BorderBrush="#D9DEEA"
                    BorderThickness="0,0,1,1"
                    Background="{Binding Background}"
                    MinWidth="88"
                    MinHeight="40"
                    ToolTip="{Binding ToolTip}">
                <TextBlock Text="{Binding Label}"
                           FontWeight="SemiBold"
                           Foreground="{Binding Foreground}"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"/>
            </Border>
        </DataTemplate>
        <DataTemplate x:Key="GroupRowTemplate" DataType="vm:CycleGroupRow">
            <Grid x:Name="RowRoot" Margin="0,0,0,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="240"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Border Background="{Binding Accent}"
                        Opacity="0.18"
                        CornerRadius="8"
                        Margin="0,0,12,0"/>
                <Border Grid.Column="0"
                        Margin="0,0,12,0"
                        Padding="12"
                        CornerRadius="8"
                        BorderBrush="#CBD3E3"
                        BorderThickness="1"
                        Background="White">
                    <StackPanel>
                        <TextBlock Style="{StaticResource RowHeaderText}"
                                   Text="{Binding Name}"/>
                        <TextBlock Text="{Binding PointCount, StringFormat='Точек: {0}'}"
                                   Foreground="#54627B"
                                   Margin="0,6,0,0"/>
                        <Border Margin="0,10,0,0"
                                Height="4"
                                CornerRadius="2"
                                Background="{Binding Accent}"/>
                    </StackPanel>
                </Border>
                <ItemsControl Grid.Column="1"
                              ItemsSource="{Binding Cells}"
                              ItemTemplate="{StaticResource CycleCellTemplate}"
                              ItemsPanel="{StaticResource CycleRowPanel}"/>
                <Grid.Triggers>
                    <DataTrigger Binding="{Binding IsIncluded}" Value="False">
                        <Setter TargetName="RowRoot" Property="Opacity" Value="0.45"/>
                    </DataTrigger>
                </Grid.Triggers>
            </Grid>
        </DataTemplate>
        <DataTemplate x:Key="ColorOptionTemplate" DataType="vm:ColorOption">
            <StackPanel Orientation="Horizontal" Spacing="8">
                <Border Width="16" Height="16" CornerRadius="3" Background="{Binding Brush}" BorderBrush="#303030" BorderThickness="0.5"/>
                <TextBlock Text="{Binding Name}"/>
            </StackPanel>
        </DataTemplate>
        <Style TargetType="ScrollViewer">
            <Setter Property="HorizontalScrollBarVisibility" Value="Auto"/>
            <Setter Property="VerticalScrollBarVisibility" Value="Auto"/>
        </Style>
    </UserControl.Resources>

    <Grid ColumnSpacing="16" RowDefinitions="{x:Null}">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="3*"/>
            <ColumnDefinition Width="2*"/>
        </Grid.ColumnDefinitions>

        <Border Grid.Column="0" Padding="20" Background="#FFFFFF" CornerRadius="12" BorderBrush="#E2E6F0" BorderThickness="1">
            <Grid RowDefinitions="{x:Null}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,16" VerticalAlignment="Center">
                    <TextBlock Text="Циклы и группы"
                               FontSize="20"
                               FontWeight="SemiBold"
                               Foreground="#1D2747"/>
                    <TextBlock Text="{Binding Rows.Count, StringFormat=' ({0})'}"
                               Margin="6,2,0,0"
                               Foreground="#697597"/>
                </StackPanel>
                <ScrollViewer Grid.Row="1">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="240"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <Border Grid.Row="0"
                                Grid.Column="0"
                                Margin="0,0,12,0"
                                Padding="12"
                                Background="#F5F8FF"
                                BorderBrush="#D0D7E5"
                                BorderThickness="0,0,1,1"
                                CornerRadius="8,8,0,0">
                            <TextBlock Text="Группа"
                                       FontWeight="SemiBold"
                                       Foreground="#3F4B6B"/>
                        </Border>
                        <ItemsControl Grid.Row="0"
                                      Grid.Column="1"
                                      ItemsSource="{Binding Columns}"
                                      ItemTemplate="{StaticResource CycleHeaderTemplate}"
                                      ItemsPanel="{StaticResource CycleHeaderPanel}"/>

                        <ItemsControl Grid.Row="1"
                                      Grid.ColumnSpan="2"
                                      ItemsSource="{Binding Rows}"
                                      ItemTemplate="{StaticResource GroupRowTemplate}"/>
                    </Grid>
                </ScrollViewer>
            </Grid>
        </Border>

        <Border Grid.Column="1"
                Padding="20"
                Background="#FFFFFF"
                CornerRadius="12"
                BorderBrush="#E2E6F0"
                BorderThickness="1">
            <Grid RowDefinitions="{x:Null}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <StackPanel Margin="0,0,0,16">
                    <TextBlock Text="Настройки групп"
                               FontSize="20"
                               FontWeight="SemiBold"
                               Foreground="#1D2747"/>
                    <TextBlock Text="Выберите цвет и участие группы в расчётах"
                               Foreground="#697597"
                               Margin="0,4,0,0"/>
                </StackPanel>

                <ScrollViewer Grid.Row="1">
                    <ItemsControl ItemsSource="{Binding Settings}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate DataType="vm:CycleGroupSettingsEntry">
                                <Border Padding="14"
                                        Margin="0,0,0,12"
                                        Background="#F9FAFE"
                                        BorderBrush="#D7DDF0"
                                        BorderThickness="1"
                                        CornerRadius="10">
                                    <StackPanel>
                                        <TextBlock Text="{Binding Name}"
                                                   FontWeight="SemiBold"
                                                   FontSize="16"
                                                   Foreground="#243157"/>
                                        <TextBlock Text="{Binding PointSummary}"
                                                   Foreground="#596684"
                                                   Margin="0,4,0,0"/>
                                        <StackPanel Orientation="Horizontal" Margin="0,12,0,0" Spacing="10" VerticalAlignment="Center">
                                            <TextBlock Text="Цвет:" VerticalAlignment="Center"/>
                                            <ComboBox Width="160"
                                                      ItemsSource="{Binding DataContext.ColorOptions, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                      SelectedValuePath="Color"
                                                      ItemTemplate="{StaticResource ColorOptionTemplate}"
                                                      SelectedValue="{Binding AccentColor, Mode=TwoWay}"/>
                                            <Border Width="20" Height="20" CornerRadius="4" Background="{Binding AccentBrush}" BorderBrush="#8895B1" BorderThickness="1"/>
                                        </StackPanel>
                                        <CheckBox Content="Включить в расчёты"
                                                  Margin="0,12,0,0"
                                                  IsChecked="{Binding IsIncluded, Mode=TwoWay}"/>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                        <ItemsControl.Style>
                            <Style TargetType="ItemsControl">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Settings.Count}" Value="0">
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="ItemsControl">
                                                    <Border Padding="40" Background="#FBFCFF" CornerRadius="12" BorderBrush="#E0E6F8" BorderThickness="1">
                                                        <TextBlock Text="Группы не найдены для выбранного объекта"
                                                                   Foreground="#7684A6"
                                                                   HorizontalAlignment="Center"
                                                                   VerticalAlignment="Center"/>
                                                    </Border>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </ItemsControl.Style>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
        </Border>
    </Grid>
</UserControl>
